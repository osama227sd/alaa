<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>CH3 – Shared Memory & Snooping</title>
<style>
    body {
        font-family: "Segoe UI", Tahoma, Arial;
        direction: rtl;
        background-color: #f0f2f5;
        margin: 0;
        padding: 0;
    }

    .container {
        width: 90%;
        max-width: 1100px;
        margin: 30px auto;
        padding: 20px;
    }

    h1 {
        text-align: center;
        color: #2c3e50;
    }

    .part {
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        margin-bottom: 25px;
        overflow: hidden;
    }

    .part-header {
        background-color: #1e90ff;
        color: white;
        padding: 15px 20px;
        font-size: 18px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .part-header:hover {
        background-color: #0f6fd6;
    }

    .part-content {
        display: none;
        padding: 20px;
        line-height: 1.7;
    }

    h2 {
        color: #34495e;
        border-bottom: 1px solid #ddd;
        padding-bottom: 5px;
        margin-top: 0;
    }

    h3 {
        color: #1e90ff;
    }

    .note {
        background-color: #eef6ff;
        border-right: 4px solid #1e90ff;
        padding: 12px;
        margin: 10px 0;
        border-radius: 6px;
    }

    .event-box {
        background-color: #f0f8ff;
        border-right: 4px solid #1e90ff;
        padding: 12px;
        margin: 15px 0;
        border-radius: 6px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 10px 0;
    }

    table, th, td {
        border: 1px solid #ddd;
    }

    th, td {
        padding: 10px;
        text-align: center;
    }

    th {
        background-color: #1e90ff;
        color: white;
    }

    td {
        background-color: #f9f9f9;
    }

</style>
</head>
<body>
<div class="container">
    <h1>CH3 – Shared Memory & Snooping Protocols</h1>

    <!-- Part 1 -->
    <div class="part">
        <div class="part-header" onclick="togglePart(this)">Part 1 – Shared Memory Architecture</div>
        <div class="part-content">
            <h3>ما هي Shared Memory Architecture؟</h3>
            <p>هي معمارية تحتوي على أكثر من Processor، جميعها يشتركون في نفس مساحة الذاكرة (Shared Memory).</p>

            <h3>تصنيف أنظمة Shared Memory</h3>
            <ul>
                <li>Uniform Memory Access (UMA)</li>
                <li>Non-Uniform Memory Access (NUMA)</li>
                <li>Cache Only Memory Architecture (COMA)</li>
            </ul>

            <h3>1️⃣ UMA</h3>
            <div class="note">➤ كل المعالجات تصل للذاكرة بنفس السرعة.</div>

            <h3>2️⃣ NUMA</h3>
            <div class="note">➤ Local Memory أسرع من Remote Memory.</div>

            <h3>3️⃣ COMA</h3>
            <p>النظام يتكون بالكامل من Caches، البيانات تتحرك إلى الـ Processor الذي يطلبها.</p>

            <h3>Bus-Based Symmetric Multiprocessors</h3>
            <div class="note">➤ استخدام Cache يقلل الضغط على الـ Bus.</div>

            <h3>Basic Cache Coherency</h3>
            <p>تكون الـ Caches متوافقة (Coherent) عندما تكون جميع النسخ من نفس البيانات لها نفس القيمة.</p>

            <h3>Write-Through Policy</h3>
            <div class="note">➤ بسيط لكنه يسبب ضغط كبير على الـ Bus.</div>

            <h3>Write-Back Policy</h3>
            <div class="note">➤ يعتمد على Dirty Bit لمعرفة البلوك المعدّل.</div>
        </div>
    </div>

    <!-- Part 2 -->
    <div class="part">
        <div class="part-header" onclick="togglePart(this)">Part 2 – Cache-Cache Coherence & Snooping Protocols</div>
        <div class="part-content">
            <h3>Cache-Cache Coherence</h3>
            <p>لو Processor P طلب بيانات X وProcessor Q كتب على X:</p>
            <ul>
                <li>Q يقوم بإلغاء كل النسخ الأخرى.</li>
                <li>تفعيل Dirty Bit للبلوك X.</li>
                <li>Q يواصل التعديل لأنه النسخة الوحيدة الصالحة.</li>
                <li>لو P يريد القراءة لاحقًا، يجب الانتظار حتى يتم تحديث X ومسح Dirty Bit.</li>
            </ul>

            <h3>سياسات Cache-Cache</h3>
            <ul>
                <li><strong>Write-Invalidate:</strong> قراءة من الكاش المحلي حتى يحدث Write.</li>
                <li><strong>Write-Update:</strong> تحديث جميع النسخ فورًا.</li>
            </ul>

            <h3>Shared Memory System Coherence</h3>
            <ul>
                <li>Write-Update & Write-Through</li>
                <li>Write-Update & Write-Back</li>
                <li>Write-Invalidate & Write-Through</li>
                <li>Write-Invalidate & Write-Back</li>
            </ul>

            <h3>Snooping Protocols</h3>
            <p>كل Cache تراقب الـ Bus لمتابعة أي نشاط وتنفيذ أوامر التوافق. الذاكرة تتحرك على شكل Blocks.</p>

            <h3>Update Event</h3>
            <div class="event-box">
                <p>لما أحد يكتب (Update) ❗</p>
                <ul>
                    <li>1️⃣ كل النسخ الأخرى تُلغى (Invalidate)</li>
                    <li>2️⃣ تحديث الذاكرة الرئيسية</li>
                </ul>
            </div>

            <h3>حالات البلوك (State Description)</h3>
            <table>
                <tr>
                    <th>الحالة</th>
                    <th>الاختصار</th>
                    <th>الوصف</th>
                </tr>
                <tr>
                    <td>Valid</td>
                    <td>[VALID]</td>
                    <td>النسخة متوافقة مع الذاكرة</td>
                </tr>
                <tr>
                    <td>Invalid</td>
                    <td>[INV]</td>
                    <td>النسخة غير متوافقة</td>
                </tr>
            </table>

            <h3>حالات الأحداث – Snooping Protocol</h3>
            <div class="event-box">
                <h4>Read Hit</h4>
                <p>استخدم النسخة المحلية من الكاش، القراءة تمت بسرعة.</p>
            </div>
            <div class="event-box">
                <h4>Read Miss</h4>
                <p>جلب نسخة من Global Memory وضبطها Valid.</p>
            </div>
            <div class="event-box">
                <h4>Write Hit</h4>
                <p>الكتابة في الكاش، إرسال Invalidate، تحديث الذاكرة.</p>
            </div>
            <div class="event-box">
                <h4>Write Miss</h4>
                <p>جلب نسخة، إرسال Invalidate، تحديث النسخة المحلية وGlobal Memory.</p>
            </div>
            <div class="event-box">
                <h4>Block Replace</h4>
                <p>إزالة البلوك من الكاش بأمان.</p>
            </div>

            <h3>Write-Invalidate & Write-Back (Ownership Protocol)</h3>
            <table>
                <tr>
                    <th>الحالة</th>
                    <th>الاختصار</th>
                    <th>الوصف</th>
                    <th>ملاحظات</th>
                </tr>
                <tr>
                    <td>Shared (Read-Only)</td>
                    <td>[RO]</td>
                    <td>البيانات صالحة للقراءة</td>
                    <td>يمكن أكثر من نسخة بنفس الحالة في كاشات مختلفة</td>
                </tr>
                <tr>
                    <td>Exclusive (Read-Write)</td>
                    <td>[RW]</td>
                    <td>نسخة واحدة صالحة فقط</td>
                    <td>أي نسخة في كاش آخر Invalid</td>
                </tr>
                <tr>
                    <td>Invalid</td>
                    <td>[INV]</td>
                    <td>النسخة غير متوافقة</td>
                    <td>لا تستخدم</td>
                </tr>
            </table>

            <ul>
                <li>Read Hit: استخدم النسخة المحلية</li>
                <li>Read Miss: جلب نسخة من Global Memory أو Cache Exclusive</li>
                <li>Write Hit: إذا Exclusive → كتابة محلية، إذا Shared → Invalidate + Exclusive</li>
                <li>Write Miss: جلب نسخة، إرسال Invalidate، تحديث النسخة المحلية لضبط Exclusive</li>
                <li>Block Replacement: لو Exclusive → كتابة في Main Memory، إذا Shared/Invalid → لا حاجة للكتابة</li>
            </ul>
        </div>
    </div>
</div>

<script>
function togglePart(header){
    const content = header.nextElementSibling;
    content.style.display = (content.style.display === "block") ? "none" : "block";
}
</script>

</body>
</html>
